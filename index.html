<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malware Scanner</title>
    <style>
        #debug-log {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }
        #scan-result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .error { color: red; }
        .success { color: green; }
        .pending { color: orange; }
    </style>
    <script>
        let debugLog = [];

        function log(message) {
            const timestamp = new Date().toISOString();
            const logMessage = `${timestamp}: ${message}`;
            debugLog.push(logMessage);
            console.log(message);
            updateDebugLog();
        }

        function updateDebugLog() {
            const debugElement = document.getElementById('debug-log');
            debugElement.textContent = debugLog.join('\n');
        }

        function toggleDebug() {
            const debugElement = document.getElementById('debug-log');
            debugElement.style.display = debugElement.style.display === 'none' ? 'block' : 'none';
        }

        async function scanFile() {
            const fileInput = document.getElementById("file");
            const resultDiv = document.getElementById("scan-result");
            
            if (fileInput.files.length === 0) {
                log("Error: No file selected");
                resultDiv.innerHTML = "<p class='error'>Please select a file to scan.</p>";
                return;
            }

            const file = fileInput.files[0];
            log(`Selected file: ${file.name} (${file.size} bytes)`);

            resultDiv.innerHTML = "<p class='pending'>Scanning file...</p>";
            
            const formData = new FormData();
            formData.append("file", file);

            try {
                log("Sending scan request...");
                const response = await fetch("https://70e62922-a34b-4e41-b6ed-599eddc680e3-00-5txbyvj2ktui.riker.replit.dev/scan", {
                    method: "POST",
                    body: formData
                });
                
                log(`Server response status: ${response.status}`);
                
                const result = await response.text();
                log(`Scan result: ${result}`);

                let resultHtml = "";
                if (result === "clean") {
                    resultHtml = "<p class='success'>File is Clean</p>";
                } else if (result === "malicious") {
                    resultHtml = "<p class='error'>Malware Detected!</p>";
                } else {
                    resultHtml = `<p class='error'>Scan Failed: ${result}</p>`;
                }

                resultDiv.innerHTML = resultHtml;

            } catch (error) {
                log(`Error during scan: ${error.message}`);
                resultDiv.innerHTML = `<p class='error'>Error scanning file: ${error.message}</p>`;
            }
        }
    </script>
</head>
<body>
    <h1>Static Malware Scanner</h1>
    <input type="file" id="file">
    <button onclick="scanFile()">Scan</button>
    <button onclick="toggleDebug()">Toggle Debug Log</button>
    <div id="scan-result"></div>
    <div id="debug-log"></div>
</body>
</html>
